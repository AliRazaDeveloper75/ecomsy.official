<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment | Ecomsy</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #00539c;
        --secondary-color: #003f7d;
        --accent-color: #ff6b00;
        --light-gray: #f5f7fa;
        --dark-gray: #333;
        --success-color: #28a745;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: var(--light-gray);
      }

      .container {
        max-width: 1000px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .payment-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        margin-top: 20px;
      }

      .order-summary {
        flex: 1;
        min-width: 300px;
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .payment-section {
        flex: 1;
        min-width: 300px;
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      h1 {
        color: var(--primary-color);
        margin-bottom: 20px;
        font-size: 28px;
        text-align: center;
      }

      h2 {
        color: var(--primary-color);
        margin-bottom: 15px;
        font-size: 22px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
      }

      .order-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 10px 0;
        border-bottom: 1px dashed #eee;
      }

      .order-item:last-child {
        border-bottom: none;
      }

      .order-item .label {
        font-weight: 600;
        color: var(--dark-gray);
      }

      .order-item .value {
        text-align: right;
      }

      .total {
        font-size: 18px;
        font-weight: bold;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 2px solid var(--primary-color);
      }

      .payment-methods {
        margin-top: 20px;
      }

      .payment-method {
        display: flex;
        align-items: center;
        padding: 15px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .payment-method:hover {
        border-color: var(--primary-color);
        background-color: #f8f9fa;
      }

      .payment-method.selected {
        border-color: var(--primary-color);
        background-color: #f0f7ff;
      }

      .payment-method i {
        font-size: 24px;
        margin-right: 15px;
        color: var(--primary-color);
      }

      .payment-method .method-info {
        flex-grow: 1;
      }

      .payment-method .method-name {
        font-weight: 600;
        margin-bottom: 5px;
      }

      .payment-method .method-description {
        font-size: 14px;
        color: #666;
      }

      .btn {
        display: block;
        width: 100%;
        padding: 12px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
        transition: all 0.3s;
      }

      .btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .btn i {
        margin-right: 8px;
      }

      .account-details {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 5px;
        margin-top: 15px;
        font-size: 14px;
      }

      .account-details p {
        margin-bottom: 8px;
      }

      .success-message {
        color: var(--success-color);
        text-align: center;
        margin-top: 20px;
        font-weight: 600;
        display: none;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }

      .required::after {
        content: " *";
        color: #ff6b00;
      }

      .verification-section {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px dashed #eee;
      }

      @media (max-width: 768px) {
        .payment-container {
          flex-direction: column;
        }

        .order-summary,
        .payment-section {
          min-width: 100%;
        }
      }

      .formspree-success {
        display: none;
        background-color: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Complete Your Payment</h1>

      <div class="payment-container">
        <div class="order-summary">
          <h2>Order Summary</h2>
          <div id="orderDetails"></div>
        </div>

        <div class="payment-section">
          <h2>Payment Method</h2>

          <div class="payment-methods">
            <div class="payment-method selected" id="bank-method">
              <i class="fas fa-university"></i>
              <div class="method-info">
                <div class="method-name">Bank Transfer</div>
                <div class="method-description">Direct bank transfer</div>
              </div>
            </div>
          </div>

          <!-- Bank Transfer -->
          <div id="bank-payment">
            <div class="account-details">
              <p><strong>Bank Name:</strong> United Bank Limited (UBL)</p>
              <p><strong>Account Title:</strong> ECOMSY SMC PVT LTD</p>
              <p><strong>Account Number:</strong> 334242866</p>
              <p><strong>IBAN:</strong> PK56 UNIL 0109 0003 3424 2866</p>
              <p><strong>Branch Code:</strong> 0936</p>
              <p><strong>Amount:</strong> <span id="bank-amount"></span></p>
            </div>

            <div class="verification-section">
              <p><strong>Payment Verification:</strong></p>
              <p>
                After making the bank transfer, please provide the following
                details for verification:
              </p>

              <div class="form-group">
                <label for="account-title" class="required"
                  >Account Title (Sender Name)</label
                >
                <input
                  type="text"
                  id="account-title"
                  class="form-control"
                  placeholder="Name as it appears in your bank account"
                  required
                />
              </div>

              <div class="form-group">
                <label for="transaction-id" class="required"
                  >Transaction ID/Reference Number</label
                >
                <input
                  type="text"
                  id="transaction-id"
                  class="form-control"
                  placeholder="Unique transaction reference from your bank"
                  required
                />
              </div>

              <div class="form-group">
                <label for="payment-date">Payment Date</label>
                <input type="date" id="payment-date" class="form-control" />
              </div>
            </div>

            <button class="btn" id="submit-payment">
              <i class="fas fa-check-circle"></i> Submit Payment Details
            </button>

            <div class="formspree-success" id="formspree-success">
              <i class="fas fa-check-circle"></i> Your payment details have been
              submitted successfully! We will verify your payment and contact
              you shortly.
            </div>

            <div class="success-message" id="bank-success">
              Payment received! Redirecting to confirmation...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden Formspree Form -->
    <form
      id="email-form"
      style="display: none"
      action="https://formspree.io/f/xrbaoond"
      method="POST"
    >
      <input type="text" name="name" id="formspree-name" />
      <input type="email" name="email" id="formspree-email" />
      <input type="text" name="course" id="formspree-course" />
      <input type="text" name="amount" id="formspree-amount" />
      <input
        type="text"
        name="registrationNumber"
        id="formspree-registration"
      />
      <input type="text" name="whatsapp" id="formspree-whatsapp" />
      <!-- Added this field -->
      <input type="text" name="accountTitle" id="formspree-account-title" />
      <input type="text" name="transactionId" id="formspree-transaction-id" />
      <input type="text" name="paymentDate" id="formspree-payment-date" />
      <button type="submit" id="formspree-submit">Send</button>
    </form>

    <script>
      // Retrieve stored data
      let storedData;
      try {
        const data = localStorage.getItem("courseRegistrationData");
        if (data) {
          storedData = JSON.parse(data);
        } else {
          // If no data in localStorage, check if we have URL parameters
          const urlParams = new URLSearchParams(window.location.search);
          const course = urlParams.get("course");
          const price = urlParams.get("price");
          const name = urlParams.get("name");
          const email = urlParams.get("email");
          const whatsapp = urlParams.get("whatsapp");
          const regNumber = urlParams.get("regNumber");

          if (course && price) {
            storedData = {
              course: course,
              coursePrice: price,
              name: name || "Not provided",
              email: email || "Not provided",
              whatsapp: whatsapp || "Not provided",
              registrationNumber:
                regNumber ||
                "EC" +
                  new Date().getDate() +
                  (new Date().getMonth() + 1) +
                  new Date().getFullYear().toString().substr(-2) +
                  "-" +
                  Math.floor(100000 + Math.random() * 900000),
            };
          } else {
            // Fallback to sample data for demonstration
            storedData = {
              course: "Amazon FBA Mastery – Private Label + Wholesale Combined",
              coursePrice: "PKR 34,500",
              name: "Kashaf Allah Ditta",
              email: "kashafallahditta@gmail.com",
              whatsapp: "Not provided",
              registrationNumber: "EC200825-318928",
            };
          }
        }
      } catch (e) {
        console.error("Error retrieving stored data:", e);
        // Fallback to sample data
        storedData = {
          course: "Amazon FBA Mastery – Private Label + Wholesale Combined",
          coursePrice: "PKR 34,500",
          name: "Kashaf Allah Ditta",
          email: "kashafallahditta@gmail.com",
          whatsapp: "Not provided",
          registrationNumber: "EC200825-318928",
        };
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function () {
        displayOrderDetails();
        updatePaymentAmounts();
        setupFormSubmission();
      });

      // Display order details
      function displayOrderDetails() {
        const orderDetails = document.getElementById("orderDetails");

        if (storedData) {
          orderDetails.innerHTML = `
            <div class="order-item">
              <span class="label">Course:</span>
              <span class="value">${storedData.course || "Not specified"}</span>
            </div>
            <div class="order-item">
              <span class="label">Registration Number:</span>
              <span class="value">${
                storedData.registrationNumber || "Not assigned"
              }</span>
            </div>
            <div class="order-item">
              <span class="label">Student Name:</span>
              <span class="value">${storedData.name || "Not provided"}</span>
            </div>
            <div class="order-item">
              <span class="label">Email:</span>
              <span class="value">${storedData.email || "Not provided"}</span>
            </div>
            <div class="order-item">
              <span class="label">WhatsApp:</span>
              <span class="value">${
                storedData.whatsapp || "Not provided"
              }</span>
            </div>
            <div class="order-item total">
              <span class="label">Total Amount:</span>
              <span class="value">${storedData.coursePrice || "PKR 0"}</span>
            </div>
          `;
        } else {
          orderDetails.innerHTML = `<p>No order data found. Please complete the registration form first.</p>`;
        }
      }

      // Update payment amounts based on stored data
      function updatePaymentAmounts() {
        const amount = storedData.coursePrice || "PKR 0";
        document.getElementById("bank-amount").textContent = amount;
      }

      // Setup form submission
      function setupFormSubmission() {
        const submitButton = document.getElementById("submit-payment");

        submitButton.addEventListener("click", function () {
          // Validate required fields
          const accountTitle = document
            .getElementById("account-title")
            .value.trim();
          const transactionId = document
            .getElementById("transaction-id")
            .value.trim();

          if (!accountTitle) {
            alert("Please enter the account title (sender name)");
            return;
          }

          if (!transactionId) {
            alert("Please enter the transaction ID/reference number");
            return;
          }

          // Show processing state
          submitButton.disabled = true;
          submitButton.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Processing...';

          // Send the email via Formspree
          sendPaymentEmail(accountTitle, transactionId);
        });
      }

      // Function to send payment email via Formspree
      function sendPaymentEmail(accountTitle, transactionId) {
        // Set form values
        document.getElementById("formspree-name").value =
          storedData.name || "Not provided";
        document.getElementById("formspree-email").value =
          storedData.email || "Not provided";
        document.getElementById("formspree-course").value =
          storedData.course || "Not specified";
        document.getElementById("formspree-amount").value =
          storedData.coursePrice || "PKR 0";
        document.getElementById("formspree-registration").value =
          storedData.registrationNumber || "Not assigned";
        document.getElementById("formspree-whatsapp").value =
          storedData.whatsapp || "Not provided"; // Added this line
        document.getElementById("formspree-account-title").value = accountTitle;
        document.getElementById("formspree-transaction-id").value =
          transactionId;

        const paymentDate = document.getElementById("payment-date").value;
        document.getElementById("formspree-payment-date").value =
          paymentDate || "Not provided";

        // Submit the form
        document.getElementById("formspree-submit").click();

        // Show success message
        document.getElementById("formspree-success").style.display = "block";

        // Store payment confirmation
        const paymentData = {
          method: "bank",
          transactionId: transactionId,
          accountTitle: accountTitle,
          timestamp: new Date().toISOString(),
        };

        // Update stored data with payment info
        storedData.payment = paymentData;
        localStorage.setItem(
          "courseRegistrationData",
          JSON.stringify(storedData)
        );

        // Reset button after delay
        setTimeout(function () {
          document.getElementById("submit-payment").disabled = false;
          document.getElementById("submit-payment").innerHTML =
            '<i class="fas fa-check-circle"></i> Submit Payment Details';
        }, 3000);
      }
    </script>
  </body>
</html>
